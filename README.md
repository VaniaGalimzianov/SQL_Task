## Тестовое задание на должность Стажер разработчик MS SQL
* **Выполнил:** Галимзянов Иван
* **Дата выполнения:** 15.01.2025
* **Полный код процедуры:** ссылка 

## Часть 1
**Задание:** заказчик утверждает, что продажи с НДС по сети, по группе товаров 'Биологически активные добавки', в июне 2017 составил 1 782 949.1 руб., продажи шт. - 6761.10. Необходимо найти и устранить возможные причины расхождений.

**Решение:** необходимо было изменить код процедуры `sp_report_1` и сравнить результат с данными заказчика. Поэтому были внесены некоторые изменения:

```sql
SUM(f.sale_net) AS [Общая стоимость товаров, с НДС],        
SUM(f.quantity) AS [Общее количество товаров]
```

**Результат:**

| Общая стоимость товаров, с НДС | Общее количество товаров |
|--------------------------------|--------------------------|
|  1679529.58                    | 6763.10                  |

**Пояснения:**
* Заказчик расчитывал стоимость товаров без учета НДС, то есть валовую стоимость
* Я изменил `f.sale_grs` на `f.sale_net`, чтобы расчитать продажи с НДС

## Часть 2
**Задание:** необходимо добавить показатели:
* Средняя цена закупки руб., без НДС
* Маржа руб. без НДС
* Наценка % без НДС

**Решение:** требуемые показатели были расчитаны следующим образом:
* Средняя цена закупки руб., без НДС – общая стоимость закупки, деленная на общее количество проданных единиц
* Маржа руб. без НДС – разница между общей суммой продаж без НДС и стоимостью закупки товаров без НДС
* Наценка % без НДС – частное от маржы и общей стоимостью закупки, умноженное на 100%

```sql
SUM(f.cost_grs * f.quantity) / SUM(f.quantity) AS [Средняя цена закупки руб., без НДС],    
SUM(f.sale_grs * f.quantity) - SUM(f.cost_grs * f.quantity) AS [Маржа руб. без НДС],    
CASE     
  WHEN SUM(f.cost_grs * f.quantity) = 0 THEN NULL     
  ELSE ((SUM(f.sale_grs * f.quantity) - SUM(f.cost_grs * f.quantity)) / SUM(f.cost_grs * f.quantity)) * 100     
END AS [Наценка % без НДС]
```

**Результат:**

| Общая стоимость товаров, с НДС | Общее количество товаров | Средняя цена закупки руб., без НДС | Маржа руб., без НДС | Наценка %, без НДС
|:-------------------------------|:-------------------------|:-----------------------------------|:--------------------|:-----------------|
|  1679529.58                    | 6763.10                  | 474.0161                           | 892493.3086         | 27.83            |

**Пояснения:**
* В вычислениях показателей обработаны случаи, когда возможно деление на ноль

